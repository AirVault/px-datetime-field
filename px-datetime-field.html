
<!--
    Relative paths assume component is being run from inside an app or another component, where dependencies are flat
    siblings. When this component is run from its own repo (e.g. ui tests, examples), we assume the server is started with
    'grunt depserve' (or similar server setup) to enable correct finding of bower dependencies for local runs.
-->
<link rel="import" href="../polymer/polymer.html"/>
<link rel="import" href="../px-datetime-common/px-datetime-imports.html"/>
<link rel="import" href="../px-datetime-common/px-datetime-entry.html"/>
<link rel="import" href="../px-datetime-common/px-datetime-behavior.html"/>


<!--

##### Usage

    <px-datetime-field></px-datetime-field>

@element px-datetime-field
@blurb Element providing solution to no problem in particular.
@homepage index.html
@demo demo.html
-->
<dom-module id="px-datetime-field">
  <link rel="import" type="css" href="css/px-datetime-field.css"/>
  <template>
    <div class$="{{_getWrapperClass(dateIsValid, timeIsValid, isSelected)}}">
      <template is="dom-if" if="{{!hideDate}}">
        <px-datetime-entry
          class$="{{_getEntryDateClass(hideDate, hideTime)}}"
          date-or-time="Date"
          moment-format="{{dateFormat}}"
          moment-obj="{{momentObj}}"
          is-valid="{{dateIsValid}}"
          is-selected="{{isSelected}}"
          hide-icon="{{hideIcon}}"
          time-zone="{{timeZone}}"
          show-time-zone="{{_showTimeZoneInDate(hideTime, showTimeZone)}}"
          block-future-dates="{{blockFutureDates}}">
        </px-datetime-entry>
      </template>
      <template is="dom-if" if="{{!hideTime}}">
        <px-datetime-entry
          date-or-time="Time"
          moment-format="{{timeFormat}}"
          show-time-zone="{{showTimeZone}}"
          moment-obj="{{momentObj}}"
          is-valid="{{timeIsValid}}"
          hide-icon="{{hideIcon}}"
          time-zone="{{timeZone}}"
          is-selected="{{isSelected}}"
          block-future-dates="{{blockFutureDates}}">
        </px-datetime-entry>
      </template>
    </div>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'px-datetime-field',

    behaviors: [pxDatetimeBehavior],
    /**
     * Properties block, expose attribute values to the DOM via 'reflect'
     *
     * @property properties
     * @type Object
     */
    properties: {
      // /**
      //  * Moment format used for the date
      //  *
      //  */
      // dateFormat: {
      //     type: String,
      //     value: 'MM/DD/YYYY'
      // },
      // /**
      //  * Moment format used for the time
      //  *
      //  */
      // timeFormat: {
      //     type: String,
      //     value: 'HH:mm A'
      // },
      /**
       *
       * Can be set to show the timezone. Can have 2 values:
       *  'dropdown': shows the time zone as a dropdown which the user can use to
       * select a different time zone. Only contains a subset of all timezones
       *  'extendedDropdown': shows the time zone as a dropdown which the user can use to
       * select a different time zone. Contains all existing timezones (588)
       *  'text': shows the time zone as text, non editable
       *  'abbreviatedText': shows the time zone as an abbreviated text, non editable (such as PST, EST...)
       */
      showTimeZone: {
        type: String,
        value: ''
      },
      /**
       * Controls whether time is displayed in this field
       */
      hideTime: {
        type: Boolean,
        value: false
      },
      /**
       * Controls whether date should be hidden in this field. Typically used
       * in combination with hideTime to make the field showing only the time
       */
      hideDate: {
        type: Boolean,
        value: false
      },
      /**
       *  Whether the date shown is valid.
       *
       */
      dateIsValid: {
        type: Boolean,
        value: true,
        notify: true
      },
      /**
       *  Whether the time shown is valid.
       *
       */
      timeIsValid: {
        type: Boolean,
        value: true,
        notify: true
      },
      /**
       *  If showing only the date whether the date is valid, if showing only the
       *  time whetehr the time is valid, if showing both whether both are valids
       *
       */
      isValid: {
        type: Boolean,
        computed: '_getIsValid(dateIsValid, timeIsValid)'
      },
      /**
       *  True if any cell is currently selected.
       * @private
       */
      isSelected: {
        type: Boolean,
        notify: true
      },
      /**
       * Whether the field is editable inline or always an editable text field
       * True - field is inline editable
       * False - field is always an editable text field
       */
      inlineEdit: {
        type: Boolean,
        value: false
      },
      /**
       *
       * Whether the calendar/clock icon should be hidden
       *
       */
      hideIcon: {
        type: Boolean,
        value: false
      }
    },
    /**
     *
     * inline--flex - add to keep the two entries inline
     *
     */
    _getWrapperClass: function(dateIsValid, timeIsValid, isSelected) {
      var classList = "inline--flex dt-text-field ";

      if(dateIsValid !== true || timeIsValid !== true) {
        classList += "validation-failed ";
      } else if(isSelected) {
        classList += "dt-is-selected "
        //find a way to trigger selected on the input field
      }

      return classList;
    },

    _getEntryDateClass: function(hideDate, hideTime) {
      var classList = "";

      if(hideDate === false && hideTime === false) {
        classList += "u-mr- ";
      }

      return classList;
    },

    _showTimeZoneInDate: function(hideTime, showTimeZone) {
      if(hideTime || hideTime === true) {
        return showTimeZone;
      }else {
        return ''
      }
    },
    _getIsValid: function(dateIsValid, timeIsValid) {
      return dateIsValid && timeIsValid;
    }
  });
</script>
